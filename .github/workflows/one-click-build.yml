name: ðŸš€ EZ-Theme ä¸€é”®æ‰“åŒ…

on:
  workflow_dispatch:
    inputs:
      title:
        description: 'ç½‘ç«™æ ‡é¢˜'
        required: true
        default: 'EZ-DEMO-TITLE'
        type: string
      env:
        description: 'çŽ¯å¢ƒ'
        required: true
        default: 'production'
        type: choice
        options:
        - production
        - development
      debugging:
        description: 'å¯ç”¨åè°ƒè¯•'
        required: true
        default: true
        type: boolean
      obfuscation:
        description: 'é…ç½®æ··æ·†'
        required: true
        default: true
        type: boolean

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: ðŸ“¥ èŽ·å–ä»£ç 
      uses: actions/checkout@v3

    - name: ðŸ”§ è®¾ç½® Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'
        cache: 'npm'

    - name: ðŸ“¦ å®‰è£…ä¾èµ–
      run: |
        npm install
        npm install defu
        npm i --package-lock-only  # ç”Ÿæˆ package-lock.json é¿å…æŠ¥é”™

    - name: âš™ï¸ åˆ›å»ºçŽ¯å¢ƒé…ç½®
      run: |
        cat > .env.production << EOF
        NODE_ENV=production
        VUE_APP_TITLE=${{ github.event.inputs.title }}
        VUE_APP_ENV=${{ github.event.inputs.env }}
        VUE_APP_DEBUGGING=${{ github.event.inputs.debugging }}
        VUE_APP_CONFIGJS=true
        VUE_APP_OBFUSCATION=${{ github.event.inputs.obfuscation }}
        EOF

    - name: ðŸ”¨ æ‰§è¡Œæž„å»º
      run: |
        npm run build

    - name: ðŸ“¦ æ‰“åŒ…æž„å»ºæ–‡ä»¶
      run: |
        zip -r build.zip dist/

    - name: ðŸš€ åˆ›å»º Release
      id: release
      uses: actions/create-release@v1
      with:
        tag_name: build-${{ github.run_number }}
        release_name: ðŸš€ EZ-Theme æž„å»º ${{ github.run_number }}
        body: |
          ## ðŸŽ‰ æž„å»ºå®Œæˆï¼

          ### ðŸ“‹ æž„å»ºé…ç½®
          - **ç½‘ç«™æ ‡é¢˜**: ${{ github.event.inputs.title }}
          - **çŽ¯å¢ƒ**: ${{ github.event.inputs.env }}
          - **åè°ƒè¯•**: ${{ github.event.inputs.debugging }}
          - **é…ç½®æ··æ·†**: ${{ github.event.inputs.obfuscation }}
          - **ç‹¬ç«‹é…ç½®**: âœ… å¼ºåˆ¶å¯ç”¨

          ### ðŸ“¥ ä¸‹è½½è¯´æ˜Ž
          1. ç‚¹å‡»ä¸‹æ–¹çš„ `build.zip` ä¸‹è½½æž„å»ºæ–‡ä»¶
          2. è§£åŽ‹åŽä¸Šä¼ åˆ°æ‚¨çš„æœåŠ¡å™¨
          3. é…ç½® Web æœåŠ¡å™¨æŒ‡å‘ `dist` ç›®å½•

          ### ðŸ“± æŠ€æœ¯æ”¯æŒ
          [@hami9ua](https://t.me/hami9ua)
        draft: false
        prerelease: false

    - name: ðŸ“¦ ä¸Šä¼ æž„å»ºæ–‡ä»¶
      uses: actions/upload-release-asset@v1
      with:
        upload_url: ${{ steps.release.outputs.upload_url }}
        asset_path: build.zip
        asset_name: build.zip
        asset_content_type: application/zip
